---
title: "kadai01"
author: "Rikiya Honda"
ddate: "02/06/2021"
output:   
  html_document: 
    toc: true
    toc_depth: 4
    toc_float: 
      collapsed: true
      smooth_scroll: true
    code_folding: 'hide'
    number_section: true
    theme: journal
    highlight: tango
    smart: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE,
                      fig.height = 6,
                      fig.width = 8)
Sys.setenv(lang = "en")
```

# ãƒ?ãƒ¼ã‚¿ã‚»ãƒ?ãƒ?cars

ä»Šå›ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ?ãƒ?`cars`ã‚’ç”¨ã?ãŸã€‚ã“ã®ãƒ?ãƒ¼ã‚¿ã‚»ãƒ?ãƒˆã?¯ã€?2ã¤ã®å¤‰æ•°ã¨50ã®è¦³æ¸¬å€¤ã‹ã‚‰æˆã‚Šç«‹ã£ã¦ã?ã‚‹ã€‚å¤‰æ•°ã¯ã€æ™‚é–“å½“ãŸã‚Šã?®ãƒã‚¤ãƒ«æ•°ã§è¨ˆç®—ã•ã‚ŒãŸè‡ªå‹•è»Šã?®ã‚¹ãƒ”ã?¼ãƒ?(speed)ã¨ã€ãã®ã‚¹ãƒ”ã?¼ãƒ‰ã‹ã‚‰è?ªå‹•è»ŠãŒåœæ­¢ã™ã‚‹ã¾ã§ã‹ã‹ã‚‹ãƒ•ã‚£ãƒ¼ãƒˆæ•°(dist)ã‹ã‚‰æˆã‚Šç«‹ã£ã¦ã?ã‚‹ã€?

ã“ã?®ãƒ?ãƒ¼ã‚¿ã‚»ãƒ?ãƒˆã?¯ã€Rã«ã‚‚ã¨ã‚‚ã¨çµ?ã¿è¾¼ã¾ã‚Œã¦ã?ã‚‹ã‚‚ã®ãªã®ã§ã€`?cars`ã§ãƒ?ãƒ¼ã‚¿ã‚»ãƒ?ãƒˆã?®èª¬æ˜ã‚’è¡¨ç¤ºã§ãã‚‹ã€?

ä»¥ä¸‹ã?®`csv`ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒ?ã‚¯ã™ã‚‹ã“ã¨ã§ãƒ?ãƒ¼ã‚¿ã‚»ãƒ?ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã€?


```{r}
url <- "https://raw.githubusercontent.com/Ricky-s-a/R_tutoring/main/Data/kadai01.csv"
kadai01 <- readr::read_csv(url)

kadai01 <- read.csv(url, encoding = "Shift-JIS")

# ç¢ºèª?
DT::datatable(kadai01, 
              rownames = FALSE, 
              extensions = 'Buttons',
              options = list(autoWidth = TRUE,
                             pageLength = 5,
                             dom = 'Bfrtip',
                             buttons = list("csv"),
                             scrollX = TRUE,
                             scrollCollapse = TRUE),
              class = 'cell-border stripe',
              caption = "source: ")
```


# ãƒ?ãƒ¼ã‚¿ã‚»ãƒ?ãƒˆã?®å‘¼ã³å‡ºã—ã‚’è¡Œã†

## ãƒ?ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿?¼ˆã‚¤ãƒ³ãƒã?¼ãƒˆï¼?
(2) ãƒ?ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿?¼ˆâ€»ãƒ?ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¤ã?ã¦?¼?
ã“ã“ã§ã¯?¼Œä¸»ã«CSV(Comma Separated Values)ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«ã¤ã?ã¦èª¬æ˜ã™ã‚‹ã€?
?¼ˆæ³¨?¼‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¤ã?ã¦
ãƒ»Windowsã§ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â?’ã€Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¤‰æ›´ã€ã§æŒ?å®šã§ãã‚‹
ãƒ»Macã§ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œãã®ä»–ã€â?’ã€Œä½œæ¥­ãƒ?ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¤‰æ›´ã€?
å®Ÿéš›ã«?¼Œãã‚Œãã‚Œã?®ç’°å¢?ã®ä¸­ã§ãƒ?ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã¨ãã?¯?¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç?è§£ãŒä¸å¯æ¬?ã«ãªã‚‹ã€?
ä¾‹ãˆã°?¼ŒJãƒ‰ãƒ©ã‚¤ãƒ–ã?®Rãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹â€sheet1.csvâ€ã‚’èª­ã¿è¾¼ã‚€ã¨ãã?¯æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹
?¼ˆå­¦é™¢ã®PCæ•™å®¤ã§ã¯Jãƒ‰ãƒ©ã‚¤ãƒ–ã«è³?æ–™ã‚’æ ¼ç´ã—ã¦ãŠã?¼‰ã€?

```{r, eval=FALSE}
# ãƒ?ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
kadai01 <- read.csv("J:/R/kadai01.csv")
```



# 1.ã€€ãƒ?ãƒ¼ã‚¿ã®æç¤º

```{r}
# ãƒ?ãƒ¼ã‚¿ã®å…ˆé?­6è¡Œã‚’ç¢ºèªã™ã‚?
head(kadai01)
```


# 2?¼åŸºæœ¬çµ±è¨ˆé‡ã®è¨ˆç®?


## å¹³å?å€¤ãƒ»æœ€å¤§å€¤ãƒ»æœ€å°å€¤ãƒ»ä¸­å¤®å€¤
```{r}
summary(kadai01)
```

## ä¸ååˆ?æ•£
```{r}
lapply(kadai01[,2:3], var)
```

## ä¸åæ¨™æº–åå·®
```{r}
lapply(kadai01[,2:3], sd)
```

# 3?¼ç›¸é–¢ä¿‚æ•°ã®è¨ˆç®—ã€€

```{r}
cor(kadai01[,2], kadai01[,3])
```




# 4.ã€€ç·šå½¢ãƒ¢ãƒ?ãƒ«ã®ç”Ÿæ??

```{r}
kadai.lm <- lm(epc ~ pop, data = kadai01)
```

## å›å¸°ç›´ç·šã?®æ–¹ç¨‹å¼ã‚’æ±‚ã‚ã‚‹ã€€

```{r}
coef(kadai.lm)
```


ä¸Šè¨˜ã?®çµæœã‹ã‚‰ã€ä»Šå›ã®å›å¸°ä¿‚æ•°ã¯ã€å??ç‰?ãŒ`r coef(kadai.lm)[[1]]`ã§ã€å‚¾ããŒ`r coef(kadai.lm)[[2]]`ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚ã“ã‚Œã‚’ç·šå½¢ã®å¼ã«ç›´ã™ã¨ã€ä»¥ä¸‹ã?®é€šã‚Šã«ãªã‚‹ã€?

$$
dist = `r coef(kadai.lm)[[1]]` + `r coef(kadai.lm)[[2]]` \times speed
$$
# 5. æ•£å¸?å›³ãŠã‚ˆã³å›å¸°ç›´ç·šã?®æç”»

```{r}
plot(kadai01[,2:3])
abline(kadai.lm)
```

# 6?¼æ®‹å·®?¼ˆãƒ†ã‚­ã‚¹ãƒ?p.83?¼‰ã?®çµ¶å¯¾å€¤ãŒæ¯”è¼?çš?å¤§ãã„éƒ½é“åºœçœŒã«æ³¨ç›®ã—ã€è?ªèº«ã®è€?å¯Ÿã‚’æ›¸ããªã•ã„ã€?

```{r}
# æ®‹æ¸£ã‚’æ±‚ã‚ã‚?
kadai01_result <- data.frame(kadai01, 
                      resid = resid(kadai.lm))


# ä¸¦ã³æ›¿ãˆã‚‹
# kadai01_result[sort(kadai01_result$resid, decreasing = F, index = T),]

library(tidyverse)
kadai01_result %>% 
  arrange(desc(resid))
```


# 7?¼ç’°å¢?çœãŒå…¬è¡¨ã™ã‚‹ã€Œç’°å¢?çµ±è¨ˆé›†?¼ˆå¹³æˆ?29å¹´åº¦ç‰ˆï¼‰ã€ï¼?URL: https://www.env.go.jp/doc/toukei/h29tbl.html?¼‰ã?®ãƒ?ãƒ¼ã‚¿ã‚’ç”¨ã?ã¦ã€ã‚°ãƒ©ãƒ•ã‚’?¼‘ã¤ä½œæ?ã—ã€è€?å¯Ÿã—ãªã•ã„ã€‚æ å†?ã«ã¯ã€â‘ ä½¿ç”¨ãƒ?ãƒ¼ã‚¿ã¨ãã?®URLã€â‘¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ?ã‚½ãƒ¼ã‚¹ã€â‘¢ã‚°ãƒ©ãƒ•ã€â‘£è€?å¯Ÿã?®?¼”ç‚¹ã‚’è¨˜è¼‰ã—ãªã•ã„ã€‚ãªãŠã€ãƒ‡ãƒ¼ã‚¿æ•´å½¢ã¯ã€å¿?ãšã—ã‚‚Rã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚è‰¯ã?ã€‚å¿?è¦ãŒã‚ã‚Œã°ã€ãƒ‡ãƒ¼ã‚¿æ•´å½¢ã«é–¢ã™ã‚‹èª¬æ˜ã‚‚ã€â‘ ä½¿ç”¨ãƒ?ãƒ¼ã‚¿ã®éƒ¨åˆ?ã«è¨˜è¼‰ã—ãªã•ã„ã€?



# ãƒ•ã‚¡ã‚¤ãƒ«æå?º

wordã«å¼µã£ã¦æå?ºã™ã‚‹ã€?


# APPENDIX

## summry of `kadai.lm`
```{r}
summary(kadai.lm)
```

## äºˆæ¸¬å€¤ã¨æ®‹å·®
æ®‹æ¸£(residuals)ã¯ã€å®Ÿéš›ã®å€¤ã¨äºˆæ¸¬å€¤ã®å·®åˆ?ã§è¨ˆç®—ã•ã‚Œã‚‹ã€?

ä»¥ä¸‹ã?®å›³ã?ã¨ã€äºˆæ¸¬å€¤ã®é’ã?®ç·šã¨å®Ÿéš›ã®å€¤ã§ã‚ã‚‹èµ¤ã®ç·šã?®é–“ãŒæ®‹å·®ã§ã‚ã‚‹ã€?

```{r}
# load packages
library(tidyverse)
library(modelr)
library(scales)

# define the data for visualization
kadai01_plot <- kadai01 %>%
  add_predictions(kadai.lm) %>% 
  add_residuals(kadai.lm) %>% 
  `names<-`(value = c("pref", "pop", "epc", "predicted_ep", "residuals")) %>% 
  pivot_longer(cols = c(-pref, -pop))

# raw v.s. expected value
kadai01_plot %>% 
  filter(name != "residuals") %>% 
  ggplot(aes(pop, value, color = name)) +
  geom_line() +
  geom_point() +
  labs(title = "The scatter plot of the predicted value and raw data based on `kadai01`",
       x = "# of population",
       y = "Electricity",
       color = "Name") +
  theme_minimal()
```

å®Ÿéš›ã®å€¤ã§ã‚ã‚‹ã‚¹ãƒ”ã?¼ãƒ‰ã?®å¤‰åŒ–ã«ã‚ˆã£ã¦ç”Ÿã˜ã‚‹æ®‹å·®ã®å€¤ã‚’ã€ã‚°ãƒ©ãƒ•åŒ–ã—ãŸã®ãŒä»¥ä¸‹ã?®å›³ã«ãªã‚‹ã€?

```{r}
# residual  
kadai01_plot %>% 
  filter(name == "residuals") %>% 
  ggplot(aes(pop, value)) +
  geom_hline(yintercept =  0, colour = "black", linetype = "dashed") +
  geom_point() +
  geom_line() +
  labs(title = "The scatter plot of the residual",
       x = "Pop",
       y = "Residuals") +
  theme_minimal()
```

