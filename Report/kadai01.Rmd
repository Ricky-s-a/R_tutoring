---
title: "kadai01"
author: "Rikiya Honda"
ddate: "02/06/2021"
output:   
  html_document: 
    toc: true
    toc_depth: 4
    toc_float: 
      collapsed: true
      smooth_scroll: true
    code_folding: 'hide'
    number_section: false
    theme: journal
    highlight: tango
    smart: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE,
                      fig.height = 6,
                      fig.width = 8)
Sys.setenv(lang = "en")
```

# データセット


```{r}
library(tidyverse)
url <- "https://raw.githubusercontent.com/Ricky-s-a/R_tutoring/main/Data/kadai01.csv"
kadai01 <- read_csv(url)

# path <- "~/R/project/R_tutoring/Git/R_tutoring/Data/kadai01.csv"
# kadai01 <- read_csv(path, locale = locale())

# show
DT::datatable(kadai01, 
              rownames = FALSE, 
              extensions = 'Buttons',
              options = list(autoWidth = FALSE,
                             pageLength = 5,
                             dom = 'Bfrtip',
                             buttons = list("csv"),
                             scrollX = TRUE,
                             scrollCollapse = TRUE),
              class = 'cell-border stripe',
              caption = "source: ")
```


# データセットの呼び出しを行う

## データの読み込み（インポート）
(2) データの読み込み（※ディレクトリについて）
ここでは，主にCSV(Comma Separated Values)ファイルの読み込みについて説明する。
（注）ディレクトリについて
・Windowsではメニュー「ファイル」→「ディレクトリの変更」で指定できる
・Macではメニュー「その他」→「作業ディレクトリの変更」
実際に，それぞれの環境の中でデータを読み込むときは，ディレクトリの理解が不可欠になる。
例えば，JドライブのRフォルダにある”sheet1.csv”を読み込むときは次のようにする
（学院のPC教室ではJドライブに資料を格納しておく）。

```{r, eval=FALSE}
# データを読み込む
kadai01 <- read.csv("J:/R/kadai01.csv")
```



# 1.　データの提示

```{r,  results='asis'}
# show the first 6 lines of `kadai01`
knitr::kable(head(kadai01))
```


# 2．基本統計量の計算


## 平均値・最大値・最小値・中央値
```{r}
summary(kadai01)
```

## 不偏分散
```{r}
lapply(kadai01[,2:3], var)
```

## 不偏標準偏差
```{r}
lapply(kadai01[,2:3], sd)
```

# 3．相関係数の計算

```{r}
cor(kadai01[,2], kadai01[,3])
```




# 4.　線形モデルの生成

```{r}
kadai.lm <- lm(epc ~ pop, data = kadai01)
```

## 回帰直線を方程式を求める　

```{r}
coef(kadai.lm)
```


上記の結果から、今回の回帰係数は、切片が`r coef(kadai.lm)[[1]]`で、傾きが`r coef(kadai.lm)[[2]]`であることがわかる。これを線形の式に直すと、以下の通りになる。

$$
epc = `r coef(kadai.lm)[[1]]` + `r coef(kadai.lm)[[2]]` \times pop
$$

# 5. 散布図および回帰直線の描画

```{r}
plot(kadai01[,2:3])
abline(kadai.lm)
```

# 6．残差（テキストp.83）の絶対値が比較的大きい都道府県に注目し、自身の考察を書きなさい。

```{r, results="asis"}
# 残渣を求める
kadai01_result <- data.frame(kadai01, 
                      resid = resid(kadai.lm))


# 並び替える
# kadai01_result[sort(kadai01_result$resid, decreasing = F, index = T),]

kadai01_result %>% 
  arrange(desc(resid)) %>% 
  head(n = 10) %>% 
  knitr::kable()
```


# 7．自己ワーク
[環境省が公表する「環境統計集（平成29年度版）」](https://www.env.go.jp/doc/toukei/h29tbl.html)
のデータを用いて、グラフを１つ作成し、考察しなさい。枠内には、①使用データとそのURL、②プログラムソース、③グラフ、④考察の４点を記載しなさい。なお、データ整形は、必ずしもRを使用しなくても良い。必要があれば、データ整形に関する説明も、①使用データの部分に記載しなさい。


# ファイル提出

コード等をwordに貼って、ファイルを提出する


# APPENDIX

## summry of `kadai.lm`
```{r}
summary(kadai.lm)
```

## 予測値と残差
残渣(residuals)は、実際の値と予測値の差分で計算される。

以下の図だと、予測値の青の線と実際の値である赤の線の間が残差である。

```{r}
# load packages
library(modelr)
library(scales)

# define the data for visualization
kadai01_plot <- kadai01 %>%
  add_predictions(kadai.lm) %>% 
  add_residuals(kadai.lm) %>% 
  `names<-`(value = c("pref", "pop", "epc", "predicted_ep", "residuals")) %>% 
  pivot_longer(cols = c(-pref, -pop))

# raw v.s. expected value
kadai01_plot %>% 
  filter(name != "residuals") %>% 
  ggplot(aes(pop, value, color = name)) +
  geom_line() +
  geom_point() +
  labs(title = "The scatter plot of the predicted value and raw data based on `kadai01`",
       x = "# of population",
       y = "Electricity",
       color = "Name") +
  theme_minimal()
```

実際の値である人口の変化によって生じる残差の値を、グラフ化したのが以下の図になる。

```{r}
# residual  
kadai01_plot %>% 
  filter(name == "residuals") %>% 
  ggplot(aes(pop, value)) +
  geom_hline(yintercept =  0, colour = "black", linetype = "dashed") +
  geom_point() +
  geom_line() +
  labs(title = "The scatter plot of the residual",
       x = "Pop",
       y = "Residuals") +
  theme_minimal()
```

